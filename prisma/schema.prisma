// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - using Clerk's user ID as the primary key
model User {
  id            String                @id // Clerk user ID
  email         String?
  firstName     String?
  lastName      String?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  
  // Relations
  questionResults UserQuestionResult[]
}

// QuizQuestion model - stores all quiz questions
model QuizQuestion {
  id            String                @id @default(cuid())
  moduleNumber  Int                   // e.g., 1, 2, 3
  activityKey   String                // e.g., "M1_1_vocab" or "activity-1.1b"
  questionKey   String                // Unique identifier for this question within the activity (e.g., "q1", "q2")
  questionText  String                // The question prompt or description
  correctAnswer String                // The correct answer (stored as JSON string for flexibility)
  conceptTags   String[]              // Array of concept tags like ["basic_vocab", "needs_vs_wants"]
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  
  // Relations
  userResults   UserQuestionResult[]
  
  @@unique([activityKey, questionKey])
  @@index([moduleNumber, activityKey])
  @@index([activityKey])
}

// UserQuestionResult model - tracks individual question attempts
model UserQuestionResult {
  id            String                @id @default(cuid())
  userId        String                // Clerk user ID
  questionId    String
  isCorrect     Boolean
  attempts      Int                   @default(1) // Number of attempts before getting it correct
  submittedAnswer String?             // What the user submitted (for debugging/analysis)
  createdAt     DateTime              @default(now())
  
  // Relations
  user          User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  question      QuizQuestion          @relation(fields: [questionId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([questionId])
  @@index([userId, questionId])
}

